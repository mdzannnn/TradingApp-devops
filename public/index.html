<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeJournal Pro 2026</title>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- THEME VARIABLES --- */
        :root {
            --bg-main: #0f172a; --bg-card: #1e293b; --bg-hover: #334155;
            --text-main: #f1f5f9; --text-muted: #94a3b8;
            --primary: #6366f1; --primary-hover: #4f46e5;
            --profit: #10b981; --profit-bg: rgba(16, 185, 129, 0.15);
            --loss: #f43f5e; --loss-bg: rgba(244, 63, 94, 0.15);
            --border: #334155;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background-color: var(--bg-main); color: var(--text-main); min-height: 100vh; display: flex; flex-direction: column; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; width: 100%; }
        
        /* HEADER & STATS */
        .header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; border-bottom: 1px solid var(--border); margin-bottom: 30px; }
        .logo { font-size: 1.5rem; font-weight: 700; color: var(--text-main); display: flex; align-items: center; gap: 10px; }
        .logo i { color: var(--primary); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--bg-card); padding: 24px; border-radius: 16px; border: 1px solid var(--border); }
        .stat-value { font-size: 2rem; font-weight: 700; margin-top: 5px; }
        .text-profit { color: var(--profit); } .text-loss { color: var(--loss); }

        /* DASHBOARD LAYOUT */
        .dashboard-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 24px; }
        @media (max-width: 900px) { .dashboard-grid { grid-template-columns: 1fr; } }
        .card { background: var(--bg-card); padding: 24px; border-radius: 16px; border: 1px solid var(--border); margin-bottom: 20px; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .card-title { font-size: 1.2rem; font-weight: 600; display: flex; align-items: center; gap: 10px; }

        /* FORMS & BUTTONS */
        .form-group { margin-bottom: 15px; }
        label { display: block; color: var(--text-muted); margin-bottom: 8px; font-size: 0.9rem; }
        input, select { width: 100%; background: var(--bg-main); border: 1px solid var(--border); color: var(--text-main); padding: 12px; border-radius: 10px; font-size: 1rem; }
        .btn { width: 100%; padding: 12px; border-radius: 10px; font-weight: 600; cursor: pointer; border: none; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); }

        /* CALENDAR */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .weekday-label { text-align: center; color: var(--text-muted); font-size: 0.85rem; padding-bottom: 10px; }
        .day-cell { aspect-ratio: 1; background: var(--bg-main); border-radius: 12px; padding: 6px; border: 1px solid transparent; display: flex; flex-direction: column; cursor: pointer; transition: 0.2s; position: relative; }
        .day-cell:hover { border-color: var(--primary); background: var(--bg-hover); transform: scale(1.02); z-index: 2; }
        .day-cell.today { border-color: var(--primary); box-shadow: 0 0 15px rgba(99, 102, 241, 0.15); }
        .pnl-chip { font-size: 0.7rem; padding: 2px 4px; border-radius: 4px; text-align: center; font-weight: 700; margin-top: auto; }
        .pnl-chip.win { background: var(--profit-bg); color: var(--profit); }
        .pnl-chip.loss { background: var(--loss-bg); color: var(--loss); }

        /* MODAL */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 100; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-overlay.active { display: flex; }
        .modal-content { background: var(--bg-card); padding: 30px; border-radius: 20px; width: 90%; max-width: 450px; border: 1px solid var(--border); }
        .close-modal { float: right; cursor: pointer; font-size: 1.5rem; background: none; border: none; color: white; }

        /* TICKER */
        .ticker-wrap { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--bg-card); border-top: 1px solid var(--border); padding: 10px 0; font-family: monospace; color: var(--text-muted); }
    </style>
</head>
<body>

<div class="container">
    <header class="header">
        <div class="logo"><i class="fa-solid fa-chart-line"></i> TradeJournal 2026</div>
        <div style="color: var(--profit); font-size: 0.9rem;"><i class="fa-solid fa-wifi"></i> Live API</div>
    </header>

    <!-- Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div style="color:var(--text-muted)">Total P&L (SGD)</div>
            <div class="stat-value" id="total-pnl">$0.00</div>
        </div>
        <div class="stat-card">
            <div style="color:var(--text-muted)">Win Rate</div>
            <div class="stat-value" id="win-rate">0%</div>
        </div>
        <div class="stat-card">
            <div style="color:var(--text-muted)">Best Trade</div>
            <div class="stat-value text-profit" id="best-trade">$0.00</div>
        </div>
    </div>

    <div class="dashboard-grid">
        <!-- LEFT: TOOLS -->
        <div class="left-col">
            <div class="card">
                <div class="card-header"><div class="card-title"><i class="fa-solid fa-calculator"></i> Quick Convert</div></div>
                <div class="form-group"><label>Amount</label><input type="number" id="qc-amount" placeholder="100"></div>
                <div class="form-group" style="display:flex; gap:10px;">
                    <select id="qc-from"><option value="USD">USD</option><option value="EUR">EUR</option><option value="JPY">JPY</option></select>
                    <span style="align-self:center;">âžœ</span>
                    <select id="qc-to"><option value="SGD">SGD</option><option value="MYR">MYR</option></select>
                </div>
                <button class="btn btn-primary" onclick="runQuickConvert()">Calculate</button>
                <div style="margin-top:10px; font-weight:bold; color:var(--profit); text-align:center;" id="qc-result"></div>
            </div>
            <div class="card">
                <div class="card-title"><i class="fa-solid fa-circle-info"></i> Instructions</div>
                <p style="color:var(--text-muted); margin-top:10px; font-size:0.9rem;">Click any date on the calendar to log a trade entry.</p>
            </div>
        </div>

        <!-- RIGHT: CALENDAR -->
        <div class="card">
            <div class="card-header">
                <div class="card-title"><i class="fa-regular fa-calendar"></i> Journal</div>
                <div style="display:flex; gap:10px; align-items:center;">
                    <button class="btn" style="width:30px; background:var(--bg-hover);" onclick="changeMonth(-1)"><</button>
                    <div id="current-month-year" style="font-weight:bold; width:120px; text-align:center;">...</div>
                    <button class="btn" style="width:30px; background:var(--bg-hover);" onclick="changeMonth(1)">></button>
                </div>
            </div>
            <div class="calendar-grid">
                <div class="weekday-label">Sun</div><div class="weekday-label">Mon</div><div class="weekday-label">Tue</div><div class="weekday-label">Wed</div><div class="weekday-label">Thu</div><div class="weekday-label">Fri</div><div class="weekday-label">Sat</div>
            </div>
            <div class="calendar-grid" id="calendar-days"></div>
        </div>
    </div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="journal-modal">
    <div class="modal-content">
        <button class="close-modal" onclick="closeModal()">&times;</button>
        <h3 style="margin-bottom:20px;">Log Trade</h3>
        <form id="trade-form">
            <input type="date" id="trade-date" readonly style="margin-bottom:10px; opacity:0.6;">
            <div class="form-group">
                <label>Currency</label>
                <select id="currency-select">
                    <option value="USD">USD</option><option value="EUR">EUR</option><option value="GBP">GBP</option>
                    <option value="JPY">JPY</option><option value="SGD">SGD</option><option value="AUD">AUD</option>
                </select>
            </div>
            <div class="form-group"><label>P&L Amount</label><input type="number" id="pnl-amount" placeholder="-50 or 150" required></div>
            <button type="submit" class="btn btn-primary">Save Entry</button>
        </form>
    </div>
</div>

<div class="ticker-wrap"><marquee id="rates-marquee">Loading Markets...</marquee></div>

<script>
    // APP STATE
    const API_URL = 'https://open.er-api.com/v6/latest/USD';
    let currentRates = { "USD":1, "SGD":1.35, "EUR":0.92, "JPY":150.2, "MYR":4.7 };
    let trades = JSON.parse(localStorage.getItem('trade_journal')) || [];
    let viewDate = new Date(2026, new Date().getMonth(), 1); // Default to current month in 2026

    // INITIALIZATION
    document.addEventListener('DOMContentLoaded', async () => {
        renderCalendar(); updateStats();
        try {
            const res = await fetch(API_URL);
            const data = await res.json();
            currentRates = data.rates;
            let ticker = "LIVE MARKETS :: ";
            ['SGD','EUR','GBP','JPY','MYR'].forEach(c => ticker += `${c}: ${data.rates[c].toFixed(3)} | `);
            document.getElementById('rates-marquee').innerText = ticker;
        } catch(e) { console.log("Offline mode"); }
    });

    // LOGIC
    function runQuickConvert() {
        const amt = parseFloat(document.getElementById('qc-amount').value);
        const from = document.getElementById('qc-from').value;
        const to = document.getElementById('qc-to').value;
        if(isNaN(amt)) return;
        const res = (amt / currentRates[from]) * currentRates[to];
        document.getElementById('qc-result').innerText = `${to} ${res.toFixed(2)}`;
    }

    function changeMonth(step) {
        const next = new Date(viewDate.getFullYear(), viewDate.getMonth() + step, 1);
        if(next.getFullYear() !== 2026) return alert("Journal restricted to 2026.");
        viewDate = next;
        renderCalendar();
    }

    function renderCalendar() {
        const grid = document.getElementById('calendar-days'); grid.innerHTML = '';
        const year = viewDate.getFullYear(); const month = viewDate.getMonth();
        document.getElementById('current-month-year').innerText = viewDate.toLocaleString('default', { month: 'long', year: 'numeric' });
        
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        for(let i=0; i<firstDay; i++) grid.appendChild(document.createElement('div'));

        for(let i=1; i<=daysInMonth; i++) {
            const dayDiv = document.createElement('div'); dayDiv.className = 'day-cell';
            const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
            const dayTrades = trades.filter(t => t.date === dateStr);
            
            let html = `<span>${i}</span>`;
            if(dayTrades.length > 0) {
                const total = dayTrades.reduce((acc, t) => acc + t.sgdAmount, 0);
                html += `<div class="pnl-chip ${total>=0?'win':'loss'}">$${Math.abs(total).toFixed(0)}</div>`;
            }
            dayDiv.innerHTML = html;
            dayDiv.onclick = () => openModal(dateStr);
            grid.appendChild(dayDiv);
        }
    }

    // MODAL
    const modal = document.getElementById('journal-modal');
    function openModal(date) {
        modal.classList.add('active');
        document.getElementById('trade-date').value = date;
    }
    function closeModal() { modal.classList.remove('active'); }
    
    document.getElementById('trade-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const date = document.getElementById('trade-date').value;
        const cur = document.getElementById('currency-select').value;
        const amt = parseFloat(document.getElementById('pnl-amount').value);
        
        const sgd = (amt / currentRates[cur]) * currentRates['SGD'];
        trades.push({ id: Date.now(), date, cur, amt, sgdAmount: sgd });
        localStorage.setItem('trade_journal', JSON.stringify(trades));
        
        closeModal(); renderCalendar(); updateStats();
    });

    function updateStats() {
        let total=0, wins=0, best=0;
        trades.forEach(t => { total+=t.sgdAmount; if(t.sgdAmount>0)wins++; if(t.sgdAmount>best)best=t.sgdAmount; });
        document.getElementById('total-pnl').innerText = `$${total.toFixed(2)}`;
        document.getElementById('total-pnl').className = `stat-value ${total>=0?'text-profit':'text-loss'}`;
        document.getElementById('win-rate').innerText = trades.length ? Math.round((wins/trades.length)*100)+'%' : '0%';
        document.getElementById('best-trade').innerText = `$${best.toFixed(2)}`;
    }
</script>
</body>
</html>
